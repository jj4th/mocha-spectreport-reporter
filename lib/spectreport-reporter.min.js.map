{"version":3,"sources":["spectreport-reporter.min.js","spectreport-reporter.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_slicedToArray","sliceIterator","arr","i","_arr","_n","_d","_e","undefined","_s","_i","Symbol","iterator","next","done","push","value","length","err","Array","isArray","Object","global","factory","exports","module","require","define","amd","spectreportReporter","Spectreport","this","screenshot","test","dir","filename","parent","title","replace","screenshotPath","browser","takeScreenshot","then","png","stream","_fs","createOutputStream","write","Buffer","end","splitPath","haystack","search","searchPath","path","resolve","relative","fullPath","dirname","basename","fs","mocha","Spec","reporters","Base","Suite","Test","defaults","screenshotDir","outputDir","storyDir","SpectReporter","runner","options","opts","reporterOptions","storyPath","outputPath","outputFilename","curSuite","console","reporter","on","suite","file","suites","_splitPath","_splitPath2","start","stop","_parent","addSuite","addTest","TEST_PENDING","TEST_PASS","TEST_FAIL","hasTests","jsonFilename","outputJsonSync"],"mappings":"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","file":"spectreport-reporter.min.js","sourcesContent":["var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\n(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('spectreport')) : typeof define === 'function' && define.amd ? define(['spectreport'], factory) : global.spectreportReporter = factory(global.Spectreport);\n})(this, function (Spectreport) {\n    'use strict';\n\n    Spectreport = 'default' in Spectreport ? Spectreport['default'] : Spectreport;\n\n    var _fs = require('fs-extra');\n    var path = require('path');\n\n    /**\n     * Takes a screenshot of a failed test and returns the relative path\n     * to that screenshot.  Note that this expects a browser object for protractor\n     * and naively assumes that the screenshots directory exists.\n     *\n     * @param {Object} test\n     * @return \"String\" screenshotPath\n     * @api private\n     */\n\n    function screenshot(test, dir) {\n        var filename = (test.parent.title + ' ' + test.title).replace(/\\W+/g, '_') + '.png';\n        var screenshotPath = dir + '/' + filename;\n\n        /*global browser*/\n        browser.takeScreenshot().then(function (png) {\n            var stream = _fs.createOutputStream(screenshotPath);\n\n            stream.write(new Buffer(png, 'base64'));\n            stream.end();\n        });\n\n        return screenshotPath;\n    }\n\n    /**\n     * For haystack underneath the search directory\n     *\n     * @param \"String\" haystack\n     * @param \"String\" search\n     * @param \"String\" replace\n     * @return \"String\",\"String\" relativePath, filename\n     * @api private\n     */\n\n    function splitPath(haystack, search, replace) {\n        var searchPath = path.resolve(search);\n        var relative = path.relative(searchPath, haystack);\n        var fullPath = path.resolve(replace, relative);\n\n        return [path.dirname(fullPath), path.basename(fullPath)];\n    }\n\n    var fs = require('fs-extra');\n\n    /**\n     * Module dependencies.\n     */\n    var mocha = require('mocha');\n    var Spec = mocha.reporters.Spec;\n    var Base = mocha.reporters.Base;\n\n    var Suite = Spectreport.Suite;\n    var Test = Spectreport.Test;\n\n    /**\n     * Default values\n     */\n    var defaults = {\n        screenshotDir: 'test/screenshots',\n        outputDir: 'test/results',\n        storyDir: 'test/stories'\n    };\n\n    /**\n     * Initialize a new `Spec` test reporter.\n     *\n     * @param {Runner} runner\n     * @api public\n     */\n\n    var SpectReporter = function SpectReporter(runner, options) {\n        _classCallCheck(this, SpectReporter);\n\n        var opts = options.reporterOptions || {};\n        var storyPath = undefined,\n            outputPath = undefined,\n            outputFilename = undefined;\n\n        // Handle options and setup defaults\n        opts.screenshotDir = opts.screenshotDir || defaults.screenshotDir;\n        opts.outputDir = opts.outputDir || defaults.outputDir;\n        opts.storyDir = opts.storyDir || defaults.storyDir;\n\n        var curSuite = null;\n\n        // Handle console output if requested, pass through to Spec reporter.\n        if (opts.console) {\n            this.reporter = new Spec(runner);\n            // Otherwise, register the default hooks on suite/test events\n        } else {\n                this.reporter = new Base(runner);\n            }\n\n        // Take screenshots of failed tests if requested\n        if (opts.screenshot) {\n            runner.on('fail', function (test) {\n                screenshot(test, opts.screenshotDir);\n            });\n        }\n\n        // Find the path for the output file, accomodate multi-suite sets.\n        storyPath = runner.suite.file || runner.suite.suites[0] && runner.suite.suites[0].file;\n\n        // If there's no file, we can't continue.\n        if (!storyPath) {\n            return true;\n        }\n\n        // Handle JSON output\n\n        var _splitPath = splitPath(storyPath, opts.storyDir, opts.outputDir);\n\n        var _splitPath2 = _slicedToArray(_splitPath, 2);\n\n        outputPath = _splitPath2[0];\n        outputFilename = _splitPath2[1];\n        runner.on('suite', function (suite) {\n            // In the case of protractor, skip the blank titled root suite.\n            if (suite.title === '' && suite.suites.length === 1) {\n                return false;\n            }\n            curSuite = new Suite(suite, curSuite);\n            curSuite.start();\n        });\n\n        runner.on('suite end', function () {\n            curSuite.stop();\n\n            if (curSuite.parent) {\n                var _parent = curSuite.parent;\n                _parent.addSuite(curSuite);\n                curSuite = _parent;\n            }\n        });\n\n        runner.on('pending', function (test) {\n            curSuite.addTest(new Test(test, Test.TEST_PENDING));\n        });\n\n        runner.on('pass', function (test) {\n            curSuite.addTest(new Test(test, Test.TEST_PASS));\n        });\n\n        runner.on('fail', function (test, err) {\n            curSuite.addTest(new Test(test, Test.TEST_FAIL, err));\n        });\n\n        runner.on('end', function () {\n            if (curSuite && curSuite.hasTests()) {\n                curSuite.stop(); // End the current suite again.\n\n                var jsonFilename = outputFilename.replace('.js', '.json');\n                fs.outputJsonSync(outputPath + '/' + jsonFilename, curSuite);\n            }\n        });\n    };\n\n    return SpectReporter;\n});","(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('spectreport')) :\n    typeof define === 'function' && define.amd ? define(['spectreport'], factory) :\n    global.spectreportReporter = factory(global.Spectreport);\n}(this, function (Spectreport) { 'use strict';\n\n    Spectreport = 'default' in Spectreport ? Spectreport['default'] : Spectreport;\n\n    const _fs = require('fs-extra');\n    const path = require('path');\n\n    /**\n     * Takes a screenshot of a failed test and returns the relative path\n     * to that screenshot.  Note that this expects a browser object for protractor\n     * and naively assumes that the screenshots directory exists.\n     *\n     * @param {Object} test\n     * @return \"String\" screenshotPath\n     * @api private\n     */\n\n    function screenshot(test, dir) {\n        let filename = (test.parent.title + ' ' + test.title).replace(/\\W+/g, '_') + '.png';\n        let screenshotPath = `${dir}/${filename}`;\n\n        /*global browser*/\n        browser.takeScreenshot().then(png => {\n            let stream = _fs.createOutputStream(screenshotPath);\n\n            stream.write(new Buffer(png, 'base64'));\n            stream.end();\n        });\n\n        return screenshotPath;\n    }\n\n    /**\n     * For haystack underneath the search directory\n     *\n     * @param \"String\" haystack\n     * @param \"String\" search\n     * @param \"String\" replace\n     * @return \"String\",\"String\" relativePath, filename\n     * @api private\n     */\n\n    function splitPath(haystack, search, replace) {\n        var searchPath = path.resolve(search);\n        var relative = path.relative(searchPath, haystack);\n        var fullPath = path.resolve(replace, relative);\n\n        return [path.dirname(fullPath), path.basename(fullPath)];\n    }\n\n    const fs = require('fs-extra');\n\n    /**\n     * Module dependencies.\n     */\n    const mocha = require('mocha');\n    const Spec = mocha.reporters.Spec;\n    const Base = mocha.reporters.Base;\n\n    const Suite = Spectreport.Suite;\n    const Test = Spectreport.Test;\n\n    /**\n     * Default values\n     */\n    const defaults = {\n        screenshotDir: 'test/screenshots',\n        outputDir: 'test/results',\n        storyDir: 'test/stories'\n    };\n\n    /**\n     * Initialize a new `Spec` test reporter.\n     *\n     * @param {Runner} runner\n     * @api public\n     */\n    class SpectReporter {\n        constructor(runner, options) {\n            const opts = options.reporterOptions || {};\n            let storyPath, outputPath, outputFilename;\n\n            // Handle options and setup defaults\n            opts.screenshotDir = opts.screenshotDir || defaults.screenshotDir;\n            opts.outputDir = opts.outputDir || defaults.outputDir;\n            opts.storyDir = opts.storyDir || defaults.storyDir;\n\n            let curSuite = null;\n\n            // Handle console output if requested, pass through to Spec reporter.\n            if (opts.console) {\n                this.reporter = new Spec(runner);\n            // Otherwise, register the default hooks on suite/test events\n            } else {\n                this.reporter = new Base(runner);\n            }\n\n            // Take screenshots of failed tests if requested\n            if (opts.screenshot) {\n                runner.on('fail', test => {\n                    screenshot(test, opts.screenshotDir);\n                });\n            }\n\n            // Find the path for the output file, accomodate multi-suite sets.\n            storyPath = runner.suite.file || (runner.suite.suites[0] && runner.suite.suites[0].file);\n\n            // If there's no file, we can't continue.\n            if(!storyPath) {\n                return true;\n            }\n\n            [outputPath, outputFilename] = splitPath(storyPath, opts.storyDir, opts.outputDir);\n\n            // Handle JSON output\n\n            runner.on('suite', suite => {\n                // In the case of protractor, skip the blank titled root suite.\n                if (suite.title === '' && suite.suites.length === 1) {\n                    return false;\n                }\n                curSuite = new Suite(suite, curSuite);\n                curSuite.start();\n            });\n\n            runner.on('suite end', () => {\n                curSuite.stop();\n\n                if (curSuite.parent) {\n                    let parent = curSuite.parent;\n                    parent.addSuite(curSuite);\n                    curSuite = parent;\n                }\n            });\n\n            runner.on('pending', test => {\n                curSuite.addTest(new Test(test, Test.TEST_PENDING));\n            });\n\n            runner.on('pass', test => {\n                curSuite.addTest(new Test(test, Test.TEST_PASS));\n            });\n\n            runner.on('fail', (test, err) => {\n                curSuite.addTest(new Test(test, Test.TEST_FAIL, err));\n            });\n\n            runner.on('end', () => {\n                if(curSuite && curSuite.hasTests()) {\n                    curSuite.stop(); // End the current suite again.\n\n                    let jsonFilename = outputFilename.replace('.js', '.json');\n                    fs.outputJsonSync(outputPath + '/' + jsonFilename, curSuite);\n                }\n            });\n        }\n    }\n\n    return SpectReporter;\n\n}));"],"sourceRoot":"/source/"}