{"version":3,"sources":["index.js","spectreport-reporter.min.js","util.js","classes/stats.js","classes/suite.js","classes/test.js"],"names":["Spec","runner","options","opts","reporterOptions","screenshotDir","defaults","outputDir","storyDir","curSuite","storyPath","suite","file","_util$splitPath","util","splitPath","_util$splitPath2","_slicedToArray","outputPath","outputFilename","console","specReporter","screenshot","on","test","Suite","start","stop","parent","addSuite","addTest","Test","TEST_PENDING","TEST_PASS","err","TEST_FAIL","jsonFilename","replace","stream","fs","createWriteStream","write","JSON","stringify","end","dir","filename","title","screenshotPath","browser","takeScreenshot","then","png","Buffer","haystack","search","relative","split","tokens","pop","path","join","_interopRequire","obj","__esModule","arr","i","Array","isArray","Symbol","iterator","Object","_step","_arr","_iterator","next","done","push","value","length","TypeError","require","module","exports","defineProperty","_createClass","defineProperties","target","props","key","prop","configurable","writable","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","Stats","tests","undefined","arguments","pending","failures","duration","this","timeStart","timeStop","add","stats","suites","addStats","hasTests","status","Date","now","Math","round","toJSON","clone","assign","_this","fullTitle","error","getOwnPropertyNames","forEach"],"mappings":"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","file":"spectreport-reporter.min.js","sourcesContent":["const fs = require('fs-extra');\nconst util = require('./util');\n\n/**\n * Module dependencies.\n */\nconst specReporter = require('../node_modules/mocha/lib/reporters/spec');\n\nimport Suite from './classes/suite';\nimport Test from './classes/test';\n\n/**\n * Default values\n */\nconst defaults = {\n    screenshotDir: 'test/screenshot',\n    outputDir: 'test/output',\n    storyDir: 'test/stories'\n};\n\n/**\n * Initialize a new `Spec` test reporter.\n *\n * @param {Runner} runner\n * @api public\n */\nfunction Spec(runner, options) {\n    const opts = options.reporterOptions || {};\n\n    // Handle options and setup defaults\n    opts.screenshotDir = opts.screenshotDir || defaults.screenshotDir;\n    opts.outputDir = opts.outputDir || defaults.outputDir;\n    opts.storyDir = opts.storyDir || defaults.storyDir;\n\n    let curSuite = null;\n\n    const storyPath = runner.suite.file;\n\n    const [outputPath, outputFilename] = util.splitPath(storyPath,\n        opts.storyDir, opts.outputDir);\n\n    // Handle console output if requested, pass through to Spec reporter.\n    if (opts.console) {\n        specReporter(runner, options);\n    }\n\n    // Take screenshots of failed tests if requested\n    if (opts.screenshot) {\n        runner.on('fail', test => {\n            util.screenshot(test, opts.screenshotDir);\n        });\n    }\n\n    // Handle JSON output\n\n    runner.on('suite', suite => {\n        curSuite = new Suite(suite, curSuite);\n        curSuite.start();\n    });\n\n    runner.on('suite end', () => {\n        curSuite.stop();\n\n        if (curSuite.parent) {\n            curSuite.parent.addSuite(curSuite);\n            curSuite = curSuite.parent;\n        }\n    });\n\n    runner.on('pending', test => {\n        curSuite.addTest(new Test(test, Test.TEST_PENDING));\n    });\n\n    runner.on('pass', test => {\n        curSuite.addTest(new Test(test, Test.TEST_PASS));\n    });\n\n    runner.on('fail', (test, err) => {\n        curSuite.addTest(new Test(test, Test.TEST_FAIL, err));\n    });\n\n    runner.on('end', () => {\n        curSuite.stop(); // End the current suite again.\n\n        let jsonFilename = outputFilename.replace('.js', '.json');\n\n        let stream = fs.createWriteStream(outputPath + '/' + jsonFilename);\n        stream.write(JSON.stringify(curSuite, null, 2));\n        stream.end();\n    });\n}\n\nexport default Spec;\n",null,"const fs = require('fs-extra');\n\n/**\n * Takes a screenshot of a failed test and returns the relative path\n * to that screenshot.  Note that this expects a browser object for protractor\n * and naively assumes that the screenshots directory exists.\n *\n * @param {Object} test\n * @return \"String\" screenshotPath\n * @api private\n */\n\nexport function screenshot(test, dir) {\n    let filename = (test.parent.title + ' ' + test.title).replace(/\\W+/g, '_') + '.png';\n    let screenshotPath = `${dir}/${filename}`;\n\n    /*global browser*/\n    browser.takeScreenshot().then(png => {\n        let stream = fs.createWriteStream(screenshotPath);\n\n        stream.write(new Buffer(png, 'base64'));\n        stream.end();\n    });\n\n    return screenshotPath;\n}\n\n/**\n * Starting from haystack in the path, clear everything up to and including\n * the search string, then prepend the replace string, and return a path and\n * a filename\n *\n * @param \"String\" haystack\n * @param \"String\" search\n * @param \"String\" replace\n * @return \"String\",\"String\" relativePath, filename\n * @api private\n */\n\nexport function splitPath(haystack, search, replace) {\n    let relative = replace + haystack.split(search)[1];\n    let tokens = relative.split('/');\n    let filename = tokens.pop();\n    let path = tokens.join('/');\n\n    return [path, filename];\n}\n","class Stats {\n    constructor(tests = 0, pending = 0, failures = 0, duration = 0) {\n        this.tests = tests;\n        this.pending = pending;\n        this.failures = failures;\n        this.duration = duration;\n        this.timeStart = null;\n        this.timeStop = null;\n    }\n    add(stats) {\n        this.tests += stats.tests;\n        this.pending += stats.pending;\n        this.failures += stats.failures;\n    }\n}\n\nexport default Stats;\n","import Stats from './stats';\nimport Test from './test';\n\nclass Suite {\n    constructor(suite, parent) {\n        this.title = suite.title;\n        this.suites = [];\n        this.tests = [];\n        this.parent = parent;\n        this.stats = new Stats();\n    }\n    addStats(stats) {\n        this.stats.add(stats);\n    }\n    addSuite(suite) {\n        if (!suite.hasTests()) {\n            return false;\n        }\n        this.suites.push(suite);\n        this.addStats(suite.stats);\n    }\n    addTest(test) {\n        this.tests.push(test);\n        this.stats.tests++;\n\n        if (test.status === Test.TEST_PENDING) {\n            this.stats.pending++;\n        }\n        else if (test.status === Test.TEST_FAIL) {\n            this.stats.failures++;\n        }\n    }\n    hasTests() {\n        return (this.tests.length > 0);\n    }\n    start () {\n        this.stats.timeStart = Date.now();\n    }\n    stop () {\n        if(!this.stats.timeStart > 0) {\n            return false;\n        }\n        this.stats.timeStop = Date.now();\n        this.stats.duration = Math.round((this.stats.timeStop - this.stats.timeStart) / 10) / 100;\n    }\n    toJSON() {\n        var clone = Object.assign({}, this);\n        clone.parent = undefined;\n        return clone;\n    }\n}\n\nexport default Suite;\n","class Test {\n    constructor(test, status, err) {\n        this.status = status;\n        this.title = test.title;\n        this.fullTitle = test.fullTitle();\n        this.duration = Math.round(test.duration / 10) / 100;\n        this.error = null;\n\n        if(err) {\n            this.error = {};\n            Object.getOwnPropertyNames(err).forEach(key => {\n                this.error[key] = err[key];\n            });\n        }\n    };\n}\n\nTest.TEST_PENDING = 2;\nTest.TEST_PASS = 1;\nTest.TEST_FAIL = 0;\n\nexport default Test;\n"],"sourceRoot":"/source/"}